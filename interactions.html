<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Expectations by jaycfields</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Expectations</h1>
        <p class="header">a minimalist's unit testing framework</p>

        <ul>
          <li><a class="buttons" href="index.html">Home</a></li>
          <li><a class="buttons" href="installing.html">Installing</a></li>
          <li><a class="buttons" href="introduction.html">Introduction</a></li>
          <li><a class="buttons" href="advanced.html">Advanced</a></li>
          <li><a class="buttons" href="collections.html">Collections</a></li>
          <li><a class="buttons" href="templating.html">Expect More</a></li>
          <li><a class="buttons" href="expect-let.html">Expect-Let</a></li>
          <li><a class="buttons" href="odds-ends.html">Odds & Ends</a></li>
          <li><a class="buttons" href="in-context.html">Around Each</a></li>
          <li><a class="buttons" href="before-run-hook.html">Before Suite</a></li>
          <li><a class="buttons" href="state-warnings.html">State Warnings</a></li>
          <li><a class="buttons" href="redef-state.html">Redef State</a></li>
          <li><a class="buttons" href="interactions.html">Side Effects</a></li>
          <li><a class="buttons" href="freeze-time.html">Freeze Time</a></li>
          <li><a class="buttons" href="env-tweaks.html">ENV Tweaks</a></li>
          <li><a class="buttons" href="emacs-tweaks.html">emacs Tweaks</a></li>
          <li><a class="buttons github" href="https://github.com/jaycfields/expectations">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/jaycfields">jaycfields</a></p>


      </header>
      <section>
        <h1>
<a name="expectations" class="anchor" href="#expectations"><span class="octicon octicon-link"></span></a>expectations</h1>

<blockquote>
<p>adding signal, removing noise</p>
</blockquote>

<h2>
<a name="interactions" class="anchor" href="#interactions"><span class="octicon octicon-link"></span></a>Interaction Based Testing</h2>

The vast majority of testing I do these days is state-based; however, there are times when I need to test an interaction (e.g. writing to a file or printing to standard out).
As of version 1.4.16, you also have the ability to test interactions with bare expectations.
<br><br>
The following test shows how you can specify an expected interaction. This test passes.
<br><br>
<script src="https://gist.github.com/3988880.js?file=blog_expectations.clj"></script>
<br>
Writing the test should be straightforward - expect the interaction and then call the code that causes the interaction to happen.
<br><br>
As I was adding this behavior I enhanced the error reporting. Below you can find a failing test and the output that is produced.
<br><br>
<script src="https://gist.github.com/jaycfields/5759131.js"></script>
<pre> ;          expected: (one "hello" {:a :b, :c {:dd :ee, :ff :gg}})
 ;               got: 0 times
 ;
 ;          -- got: (one "hello")
 ;          {:a :b, :c {:ff :gg, :dd :ee}} are in expected, but not in actual
 ;          expected is larger than actual
 ;
 ;          -- got: (one "hello" "world" "here")
 ;          "here", "world" are in actual, but not in expected
 ;          {:a :b, :c {:ff :gg, :dd :ee}} are in expected, but not in actual
 ;          actual is larger than expected
 ;
 ;          -- got: (one "hello" {2 3, :a 1})
 ;          - arg2: {2 3, :a 1}
 ;          2 with val 3 is in actual, but not in expected
 ;          :c {:dd with val :ee is in expected, but not in actual
 ;          :c {:ff with val :gg is in expected, but not in actual
 ;          :a expected: :b
 ;                  was: 1
</pre>
As you can see, all three calls to the 'one' function are reported. If the number of args used to call 'one' are of the same size as the expected args, each arg is compared in detail; otherwise the two lists are compared in detail (but the elements are not).
<br><br>
As you can see in this failure the first argument, "hello", matches.
<pre> ;          -- got: (one "hello" {2 3, :a 1})
 ;          - arg2: {2 3, :a 1}
 ;          2 with val 3 is in actual, but not in expected
 ;          :c {:dd with val :ee is in expected, but not in actual
 ;          :c {:ff with val :gg is in expected, but not in actual
 ;          :a expected: :b
 ;                  was: 1
</pre>

      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
